<%= render "devise/shared/error_messages", resource: @flashcard %>
<%= form_with model: @flashcard, local: true  do |flashcard_form| %>
  <div class="form-group">
    <%= flashcard_form.label :content, "Fragestellung" %>
    <%= flashcard_form.text_area :content, class: "form-control" %>
  </div>

  <div class="form-group">
    <%= flashcard_form.label "Artikel" %>
      <% if current_user.admin? %>
        <%= flashcard_form.select "article",
          options_for_select(
            Article.all.map { |article| [article.title, article.id] },
            @flashcard.article ? @flashcard.article.id : false
          ) %>
      <% else %>
        <%= flashcard_form.select "article",
          options_for_select(
            @articles.map { |article| [article.title, article.id] },
            @flashcard.article ? @flashcard.article.id : false
          ) %>
    <% end %>
  </div>

  <div class="form-group">
    <% flashcard_types = {
      "Multiple Choice" => "multiple_choice",
      "Richtige Reihenfolge" => "correct_order",
      "Zuordnung" => "match_answers",
      "Soll/Ist" => "soll_ist",
      "Tabelle" => "table_quiz"
    } %>
    <%= flashcard_form.label  "Fragetyp" %>
    <!-- Edit view options_for_select second argument sets the quiz type  -->
    <%= flashcard_form.select :flashcard_type,
      options_for_select(flashcard_types.to_a,
        @flashcard.flashcard_type ? [flashcard_types.key(@flashcard.flashcard_type), @flashcard.flashcard_type] : false)
    %>
  </div>

  <div class="form-group mt-5">
    <%= flashcard_form.file_field :image %>
  </div>

  <h2>Antworten</h2>
  <button  id="sollHabenView" class="btn btn-info">Soll/Haben Ansicht</button>
  <button  id="tableView" class="btn btn-info">Tabellen Ansicht</button>
  <div class="answers" id="uniqAnswers">
    <%= flashcard_form.fields_for :answers do |builder| %>
      <%= render 'answer_fields', f: builder %>
    <% end %>
  </div>

<!-- Display posibility to choose the correct answers on edit page if needed -->
  <% if @flashcard.persisted? %>

    <% if @flashcard.flashcard_type != "match_answers" %>
      <h3>Richtige Antwort</h3>
    <% end %>

    <% @flashcard.answers.each do |answer| %>
      <% case @flashcard.flashcard_type %>
        <% when 'multiple_choice' %>
          <%= render 'correct_answers_multiple_choice', answer: answer %>
        <% when 'correct_order' %>
          <%= render 'correct_answers_order', answer: answer, flashcard: flashcard %>
      <% end %>
    <% end %>
  <% end %>

  <div class="form-actions mt-5">
  <%= link_to_add_association 'Antwortmöglichkeit hinzufügen',
                                flashcard_form, :answers,
                                class: 'btn btn-success my-2',
                                data: {
                                  association_insertion_node: '#uniqAnswers', association_insertion_method: :append
                                } %>
    <%= flashcard_form.submit "Aktualisieren",
                              class: "btn btn-primary",
                              "data-turbolinks": false %>
  </div>
<% end %>

<%= link_to 'Quiz ansehen', article_flashcard_path(@flashcard.article, @flashcard), class: "btn btn-warning mt-3" if @flashcard.persisted? %>
